name: Auto ACB Newsletter

on:
  schedule:
    - cron: '0 * * * *' # Cada hora en punto
  workflow_dispatch: # Botón manual para probar

permissions:
  contents: write # IMPORTANTE

jobs:
  run-process:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      # Asegura que instale todo lo que usan tus scripts
      run: |
        pip install requests pandas beautifulsoup4 google-generativeai markdown

    - name: Ejecutar Check Status
      env:
        # Secretos necesarios para toda la cadena
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        GMAIL_USER: ${{ secrets.GMAIL_USER }}
        GMAIL_PASSWORD: ${{ secrets.GMAIL_PASSWORD }}
        URL_SUSCRIPTORES: ${{ secrets.URL_SUSCRIPTORES }}
        MAKE_WEBHOOK_URL: ${{ secrets.MAKE_WEBHOOK_URL }}
      run: python check_status.py
      
    - name: Guardar cambios en Data
      run: |
        git config --global user.name 'ACB Bot'
        git config --global user.email 'bot@noreply.github.com'
        
        # CAMBIO CLAVE AQUÍ:
        # En vez de listar archivos uno a uno, añadimos TODA la carpeta data
        # Esto maneja automáticamente si se crean, modifican o borran archivos dentro.
        git add data/
        
        # Commit y Push (solo si hubo cambios)
        git commit -m "Auto: Update Data & Status" || exit 0
        git push
